(function(){var db;databaseOpen(function(){list=document.getElementById('listSavedArticles');btnSave=document.getElementById('body_btnSaveArticle');btnDelete=document.getElementById('btnDeleteArticles');if(btnSave){btnSave.addEventListener('click',onSave);}if(btnDelete){btnDelete.addEventListener('click',function(){if(confirm('Er du sikker på, at du vil slette alle gemte artikler?')){deleteDatabase();}});}if(list){databaseGet(renderAllArticles);}});function onSave(e){e.preventDefault();var request=db.transaction(["article"],"readwrite").objectStore("article").add({id:document.getElementById('body_lblArticleID').innerHTML,headline:document.getElementById('body_lblHeadline').innerHTML,lede:document.getElementById('body_lblLede').innerHTML,date:document.getElementById('body_lblDate').innerHTML,author:document.getElementById('body_lblAuthor').innerHTML,text:document.getElementById('body_lblBodyText').innerHTML});request.onsuccess=function(event){alert("Artiklen er blevet gemt. Nu kan du se den under 'Gemte artikler' i menuen og i offlinetilstand.");btnSave.disabled=true;};request.onerror=function(event){alert("Du har allerede gemt denne artikel.");}}function databaseOpen(callback){var version=1;var request=indexedDB.open('articles',version);request.onupgradeneeded=function(e){db=e.target.result;e.target.transaction.onerror=databaseError;db.createObjectStore('article',{keyPath:['id','headline','lede','date','author','text']});};request.onsuccess=function(e){db=e.target.result;callback();/*console.log("Databasen er åbnet");*/};request.onerror=databaseError;}function databaseError(e){console.error('An IndexedDB error has occurred',e);}function databaseGet(callback){var transaction=db.transaction(['article'],'readonly');var store=transaction.objectStore('article');var keyRange=IDBKeyRange.lowerBound(0);var cursorRequest=store.openCursor(keyRange);var data=[];cursorRequest.onsuccess=function(e){var result=e.target.result;if(result){data.push(result.value);result.continue();}else{callback(data);}if(data===undefined||data.length==0){if(btnDelete){btnDelete.className="u-hidden";}list.innerHTML="<p>Du må gemme nogle artikler (muligt under hver enkelt nyhed) for at kunne læse dem her. Det skal gøres online.</p>";}};}function renderAllArticles(articles){var html='';articles.forEach(function(articles){html+='<div class="panel panel-default">';html+='<div class="panel-heading u-padding-1" role="tab" id="heading'+articles.id+'">';html+='<a class="collapsed u-link-anonymous clearfix" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse'+articles.id+'" aria-expanded="false" aria-controls="collapse'+articles.id+'">';html+='<h4 class="panel-title pull-left">'+articles.headline;html+='</h4>';html+='<i class="fa fa-angle-down pull-right"></i>';html+='</a>';html+='</div>';html+='<div id="collapse'+articles.id+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading'+articles.id+'">';html+='<div class="panel-body">';html+='<div class="u-margin-bottom-1">Offentliggjort '+articles.date+'<br />';html+='Af '+articles.author+'</div>';html+='<p><b>'+articles.lede+'</b></p>';html+=articles.text;html+='</div>';html+='</div>';html+='</div>';});list.innerHTML=html;}function deleteDatabase(){var request=indexedDB.deleteDatabase('articles');request.onsuccess=function(event){};request.onerror=function(e){console.log("Database error: "+e.target.errorCode);};window.location.replace("/SavedArticles.html");}}());